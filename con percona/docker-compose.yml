# Use root/example as user/password credentials
services:

  db:
    image: mariadb
    restart: always
    environment:
      MARIADB_ROOT_PASSWORD: 123
    
  db2:
    image: mariadb
    restart: always
    environment:
      MARIADB_ROOT_PASSWORD: 456
    
  phpmyadmin:
    image: phpmyadmin
    restart: always
    ports:
      - 8080:80
    environment:
      PMA_HOST: db 
      PMA_ARBITRARY: 1 

  phpmyadmin2:
    image: phpmyadmin
    restart: always
    ports:
      - 8082:80
    environment:
      PMA_HOST: db2
      PMA_ARBITRARY: 1

  # --- Nuevos Servicios para PMM ---

  pmm-server:
    image: percona/pmm-server:3
    container_name: pmm-server
    restart: always
    # Puertos para acceder a la interfaz web de PMM (https://localhost:8443)
    ports:
      - "8443:8443"
    # Volumen persistente para guardar los datos de configuración y métricas
    volumes:
      - pmm-data:/srv

  pmm-client:
    image: percona/pmm-client:3
    container_name: pmm-client
    restart: always
    environment:
      # Dirección del PMM Server (usamos el nombre del servicio)
      PMM_AGENT_SERVER_ADDRESS: pmm-server
      # Las credenciales por defecto para iniciar sesión en PMM
      PMM_AGENT_SERVER_USERNAME: admin
      PMM_AGENT_SERVER_PASSWORD: admin
    # Comando para agregar el servicio 'db' (MariaDB)
    command: >
      pmm-admin add mysql 
      --host=db 
      --port=3306 
      --username=root 
      --password=123 
      --service-name=mariadb_db_1
    # Nota: El cliente NO necesita abrir puertos, solo necesita la red.
    # Necesita montar /var/lib/mysql para el acceso a logs, pero para una prueba inicial esto es suficiente.

# --- Nuevos Volúmenes ---
volumes:
  pmm-data: